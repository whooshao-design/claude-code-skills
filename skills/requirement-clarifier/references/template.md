# {功能名称} - 需求规格说明书

> 本文档由需求澄清系统自动生成，请确认后用于后续方案设计。

## 1. 概述

### 1.1 功能摘要
[一句话描述这个功能做什么]

### 1.2 业务背景
[为什么需要这个功能，解决什么问题]

### 1.3 需求来源
- **来源**：[用户描述 / TAPD #12345 / 文档 @xxx]
- **优先级**：P0 / P1 / P2
- **期望上线时间**：[如有]

---

## 2. 功能范围

### 2.1 包含范围
- [ ] [能力 1]
- [ ] [能力 2]
- [ ] [能力 3]

### 2.2 不包含范围
- [ ] [不做的功能 1] - 原因：[后续迭代 / 其他人负责 / 不在本次范围内]
- [ ] [不做的功能 2] - 原因：[...]

### 2.3 依赖识别
| 类型 | 依赖项 | 负责人 | 备注 |
|------|--------|--------|------|
| 上游 | [谁提供数据] | - | - |
| 下游 | [调用谁的服务] | - | - |
| 外部 | [第三方系统] | - | - |

---

## 3. 业务规则

### 3.1 业务流程

```
[步骤描述或 ASCII 流程图]

步骤 1: 用户发起请求
步骤 2: 系统校验参数
步骤 3: 执行核心逻辑
步骤 4: 返回结果
```

### 3.2 业务规则
| 规则编号 | 规则描述 | 优先级 | 备注 |
|----------|----------|--------|------|
| R-1 | [规则1] | P0 | 必须实现 |
| R-2 | [规则2] | P1 | 建议实现 |
| R-3 | [规则3] | P2 | 可选实现 |

### 3.3 状态定义
| 状态 | 说明 | 触发条件 | 备注 |
|------|------|----------|------|
| INIT | 初始状态 | - | - |
| PROCESSING | 处理中 | 任务开始 | - |
| SUCCESS | 成功终态 | 处理成功 | - |
| FAILED | 失败终态 | 处理失败 | 可重试 |

---

## 4. 输入输出

### 4.1 输入规范
| 字段 | 类型 | 必填 | 长度限制 | 说明 | 校验规则 |
|------|------|------|----------|------|----------|
| userId | Long | 是 | - | 用户ID | > 0 |
| amount | BigDecimal | 是 | 最大 999999.99 | 金额 | > 0 |
| bizNo | String | 否 | max:32 | 业务单号 | 幂等Key |

### 4.2 输出规范
| 字段 | 类型 | 说明 | 备注 |
|------|------|------|------|
| resultCode | String | 结果码 | 0000=成功 |
| resultMsg | String | 结果描述 | - |
| data | Object | 业务数据 | - |

### 4.3 错误码
| 错误码 | 说明 | 处理建议 |
|--------|------|----------|
| E001 | 参数校验失败 | 检查输入参数 |
| E002 | 余额不足 | 提示用户 |

---

## 5. 约束与假设

### 5.1 性能要求
| 指标 | 要求 | 备注 |
|------|------|------|
| RT | < 100ms | P99 |
| QPS | > 1000 | 峰值 |
| 并发 | > 100 | 最大并发数 |

### 5.2 限制条件
| 限制项 | 限制值 | 说明 |
|--------|--------|------|
| 单笔最大金额 | 100,000 | 人民币分 |
| 单日累计金额 | 1,000,000 | 人民币分 |
| 操作频率 | 10/秒/用户 | - |

### 5.3 假设条件
- 假设 1：[说明]
- 假设 2：[说明]

---

## 6. 异常场景

| 场景 | 发生条件 | 处理方式 | 优先级 | 备注 |
|------|----------|----------|--------|------|
| 余额不足 | amount > 可用额度 | 返回错误码 | P0 | - |
| 并发冲突 | 多笔同时到达 | 拒绝后到的请求 | P0 | 乐观锁 |
| 服务超时 | 下游响应超时 | 重试/降级 | P1 | - |
| 系统异常 | 内部错误 | 记录日志/告警 | P1 | - |

---

## 7. 可观测性

### 7.1 监控指标
| 指标名称 | 指标类型 | 报警阈值 | 备注 |
|----------|----------|----------|------|
| 请求成功率 | gauge | < 99.9% | - |
| 平均RT | histogram | > 100ms | P99 |
| 错误次数 | counter | > 10/min | - |

### 7.2 埋点需求
| 埋点位置 | 埋点字段 | 说明 |
|----------|----------|------|
| 入口 | userId, bizType | 记录调用方 |
| 决策点 | decision, reason | 记录决策结果 |
| 异常 | errorCode, errorMsg | 记录错误信息 |

### 7.3 告警规则
- **成功率告警**：成功率 < 99.9% 触发 P1 告警
- **RT 告警**：P99 RT > 100ms 触发 P2 告警
- **错误率告警**：错误次数 > 10/min 触发 P1 告警

---

## 8. 验收标准

### 8.1 功能验收
- [ ] 验收点 1：[描述]
- [ ] 验收点 2：[描述]
- [ ] 验收点 3：[描述]

### 8.2 非功能验收
- [ ] RT P99 < 100ms
- [ ] 成功率 > 99.9%
- [ ] 单元测试覆盖率 > 80%
- [ ] 核心流程有集成测试

### 8.3 验收流程
1. 开发自测通过
2. 产品验收（1 个工作日）
3. UAT 验收（如需）
4. 预发布验证

---

## 9. 开放问题（Open Questions）

| ID | 问题描述 | 依赖方 | 优先级 | 状态 |
|----|----------|--------|--------|------|
| Q-1 | [问题1] | 产品 | P0 | 待确认 |
| Q-2 | [问题2] | 业务 | P1 | 待确认 |

> **说明**：开放问题需要在进入方案设计前确认。

---

## 10. 里程碑

| 里程碑 | 计划日期 | 交付物 |
|--------|----------|--------|
| 需求确认 | YYYY-MM-DD | req-spec.md |
| 方案评审 | YYYY-MM-DD | tech-spec.md + Review |
| 开发完成 | YYYY-MM-DD | 代码 + UT |
| 产品验收 | YYYY-MM-DD | 验收报告 |
| 上线 | YYYY-MM-DD | 上线 checklist |

---

## 附录

### A. 参考资料
| 文档 | 链接 | 说明 |
|------|------|------|
| 需求文档 | @docs/xxx.md | 原始需求 |
| 竞品分析 | @docs/xxx.md | 参考资料 |

### B. 术语表
| 术语 | 定义 |
|------|------|
| 术语1 | 定义 |
| 术语2 | 定义 |

### C. 历史记录
| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v1.0 | 2024-01-15 | xxx | 初始版本 |
